<!DOCTYPE html>
<!-- deploy-v3-cache-fix -->
<html>

<head>
  <script>
    // Build Version: 4.4-nuclear-head
    // This script MUST run before any other script to prevent SW interference
    (async function() {
      try {
        const DEPLOY_TIME = "1736412600"; 
        
        // Safety check for localStorage
        let storage = null;
        try {
          storage = window.localStorage;
          storage.getItem('test');
        } catch (e) {
          storage = null;
          console.warn('Storage access denied. Basic load will proceed without cache clearing.');
        }

        if (storage) {
          const lastDeploy = storage.getItem('cm_deploy_v7');
          
          if (lastDeploy !== DEPLOY_TIME) {
            console.log('Nuking all caches and storage for new version v7...');
            if ('serviceWorker' in navigator) {
              const regs = await navigator.serviceWorker.getRegistrations();
              for (let r of regs) await r.unregister();
            }
            if ('caches' in window) {
              const keys = await caches.keys();
              for (let k of keys) await caches.delete(k);
            }
            const keysToClear = [];
            for (let i = 0; i < storage.length; i++) {
              const key = storage.key(i);
              if (key && (key.includes('classmaster') || key.includes('supabase') || key.includes('sb-'))) {
                keysToClear.push(key);
              }
            }
            keysToClear.forEach(k => storage.removeItem(k));
            storage.setItem('cm_deploy_v7', DEPLOY_TIME);
            window.location.reload(true);
          }
        }
      } catch (e) {
        console.warn('Boot script error:', e);
      }
    })();
  </script>
  <title>
    <%= productName %>
  </title>

  <meta charset="utf-8">
  <meta name="description" content="<%= productDescription %>">
  <meta name="format-detection" content="telephone=no">
  <meta name="msapplication-tap-highlight" content="no">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="viewport"
    content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width<% if (ctx.mode.cordova || ctx.mode.capacitor) { %>, viewport-fit=cover<% } %>">

  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="icon" type="image/png" href="/favicon.png">
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>

<body>
  <!-- quasar:entry-point -->
</body>

</html>